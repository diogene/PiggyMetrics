version: '3.6'
services:
  config:
    environment:
      CONFIG_SERVICE_PASSWORD: $CONFIG_SERVICE_PASSWORD
    image: openjdk:8-jre
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8888/actuator/health || exit 1"]
      interval: 30s
      timeout: 3s
      retries: 5
    restart: always
    volumes: 
      - type: bind
        source: E:\etude\dev\PiggyMetrics\config\target
        target: /app
    ports:
      - 8888:8888
    logging:
      options:
        max-size: "10m"
        max-file: "10"
    command: "bash -c 'java -Xmx200m -jar /app/config.jar'"

  registry:
    environment:
      CONFIG_SERVICE_PASSWORD: $CONFIG_SERVICE_PASSWORD
    image: openjdk:8-jre
    restart: always
    volumes:
      - type: bind
        source: E:\etude\dev\PiggyMetrics\registry\target
        target: /app
      - E:/etude/dev/PiggyMetrics/config/src/main/resources/hosts:/etc/hosts
    ports:
      - 8761:8761
    depends_on:
      - config
    logging:
      options:
        max-size: "10m"
        max-file: "10"
    command: "bash -c 'java -Xmx200m -jar /app/registry.jar'"